---
layout: default
---

{% include page__hero.html %}

<div id="main" role="main">
  {% include sidebar.html %}

  <div class="archive home">

    {%- comment -%}
      タブ定義：必要ならここにカテゴリを追加/削除
      ※ permalink: /:categories/:title/ を使っている前提で、
        categories は各Postで [game] / [manga] / [movie] / [music] のように1つだけ付けるのを推奨
    {%- endcomment -%}
    {% assign rx_tabs = "game,manga,movie,music" | split: "," %}
    {% assign rx_labels = "ゲーム,マンガ,映画,音楽" | split: "," %}

    <nav class="rx-tabs" aria-label="カテゴリー切り替え">
      {% for c in rx_tabs %}
        {% assign label = rx_labels[forloop.index0] %}
        <button
          type="button"
          class="rx-tab"
          data-rx-target="{{ c }}"
          aria-controls="rx-panel-{{ c }}"
          aria-selected="false"
        >
          {{ label }}
        </button>
      {% endfor %}
    </nav>

    {% for c in rx_tabs %}

      {%- comment -%}
        site.categories[c] はカテゴリに投稿がないと nil になり得る
        → nil のまま sort すると "Cannot sort a null object." で落ちるためフォールバック
      {%- endcomment -%}
      {% assign posts_in_cat = site.categories[c] %}
      {% if posts_in_cat %}
        {% assign posts_in_cat = posts_in_cat | sort: "date" | reverse %}
      {% else %}
        {% assign posts_in_cat = "" | split: "," %}
      {% endif %}

      <section
        id="rx-panel-{{ c }}"
        class="rx-panel"
        data-rx-panel="{{ c }}"
        aria-hidden="true"
      >
        {% if posts_in_cat and posts_in_cat.size > 0 %}

          {% for post in posts_in_cat limit: 20 %}
            {% include archive-single.html type=page.entries_layout post=post %}
          {% endfor %}

          {% if posts_in_cat.size > 20 %}
            <p class="rx-more">
              <a href="{{ site.baseurl }}/categories/#{{ c | uri_escape }}">もっと見る（カテゴリ一覧へ）</a>
            </p>
          {% endif %}

        {% else %}
          <p>このカテゴリにはまだ記事がありません。</p>
        {% endif %}
      </section>

    {% endfor %}

  </div>
</div>

<script>
(function () {
  var tabs = document.querySelectorAll('.rx-tab');
  var panels = document.querySelectorAll('.rx-panel');

  function activate(key) {
    tabs.forEach(function (t) {
      var selected = (t.getAttribute('data-rx-target') === key);
      t.classList.toggle('is-active', selected);
      t.setAttribute('aria-selected', selected ? 'true' : 'false');
    });

    panels.forEach(function (p) {
      var show = (p.getAttribute('data-rx-panel') === key);
      p.style.display = show ? '' : 'none';
      p.setAttribute('aria-hidden', show ? 'false' : 'true');
    });

    try { localStorage.setItem('rx_home_tab', key); } catch (e) {}
  }

  function initialKey() {
    var hash = (location.hash || '').replace('#', '');
    if (hash) return hash;

    try {
      var saved = localStorage.getItem('rx_home_tab');
      if (saved) return saved;
    } catch (e) {}

    return 'game';
  }

  tabs.forEach(function (t) {
    t.addEventListener('click', function () {
      var key = t.getAttribute('data-rx-target');
      activate(key);
      try { history.replaceState(null, '', '#' + key); } catch (e) {}
    });
  });

  activate(initialKey());
})();
</script>
